{% extends '../componentes/base.html' %}
{% load static %}


{% block head %}
    <link rel="stylesheet" href="{% static 'css/cadastroPet.css' %}">
{% endblock %}

{% block content %}
<div class="form-section">
    <form method="POST" action="{% url 'uploadPet' %}" enctype="multipart/form-data" id="petForm">
        {% csrf_token %}

        <div>
            
                <h1>Formulário de cadastro do pet</h1>
                    <div class="first-part-container">
                    {% for field in form %}
                        {% if field.label != 'Sexo' and field.label != 'Idade'%}
                        <label>{{field.label_tag}}</label>
                        {{field}}
                        {% if field.errors %}
                            <p class="error">{{ field.errors }}</p>
                        {% endif %}
                        {% endif %}
                    {% endfor %}
                    <div class="lined-inputs">
                        <div>
                            <label>{{form.idade.label}}</label>
                            {{form.idade}}
                        </div>
                        <div>
                            <label>{{form.sexo.label}}</label>
                            <div class="radio-buttons-containers">
                                <div class="radio-buttons">
                                    <button type="button" id="machoButton" class="radio-button">Macho</button>
                                    <button type="button" id="femeaButton" class="radio-button">Fêmea</button>
                                </div>
                                {{form.sexo}}
                            </div>
                        </div>
                    </div>
                </div>
            <button type="submit" class="submitButton">Cadastrar Pet</button>
        </div>
    
        <div class="media-form-container">
            {{ imgForm.management_form }}
            <div class="images-forms">
                {% for field in imgForm %}
                    <div class="ImagemFormset">
                        <div class="img-preview-container"><button type="button" class="selectImageButton" id="0">+</button></div>
                        <div class="hidden">{{field}}</div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </form>
</div>

<script src="{% static 'js/bootstrap.min.js' %}"></script>
<script src="{% static 'js/jquery.min.js' %}"></script>
<script src="{% static 'js/jquery.formset.js' %}"></script>
<script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
<script src="{% static 'js/check_radio.js' %}"></script>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    function open(e){
        let id = e.target.getAttribute('id')
        stringId = 'id_imagem_pet-' + id + '-imagem'
        document.getElementById(stringId).click()
    }

    let selectButtons = document.querySelector('.selectImageButton')
    selectButtons.addEventListener('click', open)
    $(function() {
        $('.ImagemFormset').formset({
            prefix: '{{ imgForm.prefix }}', addText: '<div>Adicionar</div>'
        })

        function attButtons(){
            selectButtons = document.querySelectorAll('.selectImageButton')
            selectButtons.forEach((button, index) => {
                if(index != 0){
                    button.setAttribute('id', index)
                    button.addEventListener('click', open)
                }
            })
        }

        addButton = document.querySelector('.add-row')
        addButton.addEventListener('click', attButtons)
    })


</script>
{% endblock %}
